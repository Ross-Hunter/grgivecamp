<?php

function grgivecamp_custom_block($op = 'list', $delta = '', $edit = array()) {
  // The $op parameter determines what piece of information is being requested.
  switch ($op) {
    case 'list':
      // If $op is "list", we just need to return a list of block descriptions.
      // This is used to provide a list of possible blocks to the administrator;
      // end users will not see these descriptions.
      $blocks['statistics'] = array(
        'info'       => t('GR Givecamp Statistics'),
      );
      return $blocks;
    case 'view':
      // If $op is "view", then we need to generate the block for display
      // purposes. The $delta parameter tells us which block is being requested.
      switch ($delta) {
        case 'statistics':
          // The subject is displayed at the top of the block. Note that it
          // should be passed through t() for translation.
          $block['subject'] = t('GR Givecamp Statistics');
          // The content of the block is typically generated by calling a custom
          // function.
          $block['content'] = grgivecamp_custom_statistics_block();
          break;
      }
      return $block;
  }
}

function grgivecamp_custom_statistics_block(){
  // dpm(grgivecamp_custom_technical_volunteer_submissions());
  // dpm(grgivecamp_custom_non_technical_volunteer_submissions());
  // dpm(grgivecamp_custom_non_profit_submissions());

  $content = '';
  $content .= '<div class="stats">';
  $content .= '<h5>Non-Profit Applications</h5>';
  $content .= '<p>' . grgivecamp_custom_non_profit_submissions()->count . '<a href="/non-profits" class="sign-up-button">Register Now!</a>';
  $content .= '</div>';

  $content .= '<div class="stats">';
  $content .= '<h5>Volunteer Applications</h5>';
  $content .= '<p>' . grgivecamp_custom_total_volunteers() . '<a href="/get-involved" class="sign-up-button">Register Now!</a>';
  $content .= '</div>';

  $content .= '<div class="stats">';
  $content .= '<h5>Potential Value To Local Non-Profits</h5>';
  $content .= '<p>' . grgivecamp_custom_total_value() . '</p>';
  $content .= '</div>';

  return $content;
}

function grgivecamp_custom_total_value() {
  $HOURLY_RATE = 100.00;
  $TOTAL_HOURS = 48;

  $amount = "\$" . number_format(grgivecamp_custom_total_volunteers() * $HOURLY_RATE * $TOTAL_HOURS, 2);
  return $amount;
}

function grgivecamp_custom_total_volunteers() {
  $tech_count = grgivecamp_custom_technical_volunteer_submissions()->count;
  $non_tech_count = grgivecamp_custom_non_technical_volunteer_submissions()->count;

  return ($tech_count + $non_tech_count);
}

function grgivecamp_custom_non_profit_submissions() {
  return grgivecamp_custom_submissions_count(34);
}

function grgivecamp_custom_non_technical_volunteer_submissions() {
  return grgivecamp_custom_submissions_count(35);
}

function grgivecamp_custom_technical_volunteer_submissions() {
  return grgivecamp_custom_submissions_count(33);
}

function grgivecamp_custom_submissions_count($nid) {
  $query = 'SELECT nid, COUNT(*) AS count FROM {webform_submissions} WHERE nid = %d';
  $result = db_query($query, $nid);
  return db_fetch_object($result);
}

function grgivecamp_custom_2011_sponsors() {
  $sponsors = array(
    array("name" => "Microsoft", "class" => "microsoft", "url" => "http://microsoft.com"),
    array("name" => "Adam Bird", "class" => "adam_bird", "url" => "http://adambirdphoto.com"),
    array("name" => "Clark Communications", "class" => "clark", "url" => "http://www.clarkcommunication.com"),
    array("name" => "Discount ASP.net", "class" => "discountasp", "url" => "http://www.discountasp.net"),
    array("name" => "Madcap Coffee", "class" => "madcap", "url" => "http://www.madcapblog.com"),
    array("name" => "Component One", "class" => "componentone", "url" => "http://www.componentone.com"),
    array("name" => "Applied Innovation", "class" => "appliedi", "url" => "http://www.appliedi.net"),
    //array("name" => "Twisted Rooster", "class" => "twisted", "url" => "http://www.twisted-rooster.com"),
    array("name" => "Dev Express", "class" => "devexpress", "url" => "http://www.devexpress.com"),
    array("name" => "O'Reilly", "class" => "oreilly", "url" => "http://www.oreilly.com"),
    array("name" => "Redgate", "class" => "redgate", "url" => "http://www.red-gate.com"),
    array("name" => "DevPro", "class" => "devpro", "url" => "http://www.devproconnections.com"),
    array("name" => "Kentico", "class" => "kentico", "url" => "http://www.kentico.com"),
    array("name" => "Techsmith", "class" => "techsmith", "url" => "http://www.techsmith.com"),
    array("name" => "Telerik", "class" => "telerik", "url" => "http://www.telerik.com"),
    array("name" => "Comcast", "class" => "comcast", "url" => "http://www.comcast.com"),
  );

  shuffle($sponsors);
  return $sponsors;
}
